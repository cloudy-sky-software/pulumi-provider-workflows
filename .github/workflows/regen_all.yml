on: workflow_call

jobs:
  pr_commented:
    # This job only runs for pull request comments.
    name: PR comment
    if: ${{ github.event.action == 'created' && github.event.comment.body == '/regen-all' && github.event.issue.pull_request && github.event.issue.state == 'open' && !github.event.issue.pull_request.merged_at }}
    runs-on: ubuntu-latest
    steps:
      - name: Regen schema and SDKs
        run: |
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"

          make gen generate_schema build

          git add provider/cmd/pulumi-resource-*
          git add sdk/*

          git commit -am "Regen schema and SDKs"

          git push origin ${GITHUB_REF_NAME}
